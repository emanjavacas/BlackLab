<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2016-08-23 
 | Rendered using Apache Maven Fluido Skin 1.4
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20160823" />
    <meta http-equiv="Content-Language" content="en" />
    <title>BlackLab &#x2013; Change Log</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.4.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.4.min.js"></script>

                          
        
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Nunito:300"/>
          
                  </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                                                                                                <img src="images/logo-blacklab.png"  alt="BlackLab"/>
                </div>
                      </div>
        <div class="pull-right">                  <a href="http://www.inl.nl/" id="bannerRight">
                                                                                                <img src="images/logo-inl.png"  alt="INL"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="http://www.inl.nl/" class="externalLink" title="INL">
        INL</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="index.html" title="BlackLab">
        BlackLab</a>
                    <span class="divider">/</span>
      </li>
        <li class="active ">Change Log</li>
        
                
                    
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2016-08-23</li>
              <li id="projectVersion" class="pull-right">
                    Version: 1.6.0-SNAPSHOT
        </li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">BlackLab</li>
                              
      <li>
  
                          <a href="index.html" title="Introduction">
          <span class="none"></span>
        Introduction</a>
            </li>
                                                                                                                                                                                                            
      <li>
  
                          <a href="learn.html" title="Learn">
          <span class="icon-chevron-down"></span>
        Learn</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="getting-started.html" title="Getting Started">
          <span class="none"></span>
        Getting Started</a>
            </li>
                    
      <li>
  
                          <a href="corpus-query-language.html" title="Corpus Query Language">
          <span class="none"></span>
        Corpus Query Language</a>
            </li>
                    
      <li>
  
                          <a href="blacklab-server-overview.html" title="BlackLab Server overview">
          <span class="none"></span>
        BlackLab Server overview</a>
            </li>
                    
      <li>
  
                          <a href="blacklab-server-different-languages.html" title="Using BlackLab Server from different languages">
          <span class="none"></span>
        Using BlackLab Server from different languages</a>
            </li>
                    
      <li>
  
                          <a href="indexing-with-blacklab.html" title="Indexing with BlackLab">
          <span class="none"></span>
        Indexing with BlackLab</a>
            </li>
                    
      <li>
  
                          <a href="add-input-format.html" title="Add An Input Format">
          <span class="none"></span>
        Add An Input Format</a>
            </li>
                    
      <li>
  
                          <a href="improve-search-speed.html" title="Improve Search Speed">
          <span class="none"></span>
        Improve Search Speed</a>
            </li>
                    
      <li>
  
                          <a href="apidocs/index.html" title="API reference">
          <span class="none"></span>
        API reference</a>
            </li>
                    
      <li>
  
                          <a href="file-formats.html" title="File formats">
          <span class="none"></span>
        File formats</a>
            </li>
              </ul>
        </li>
                
      <li>
  
                          <a href="downloads.html" title="Downloads">
          <span class="none"></span>
        Downloads</a>
            </li>
                
      <li>
  
                          <a href="faq.html" title="FAQ">
          <span class="none"></span>
        FAQ</a>
            </li>
                
      <li class="active">
  
            <a href="#"><span class="none"></span>Change Log</a>
          </li>
                
      <li>
  
                          <a href="roadmap.html" title="Road Map">
          <span class="none"></span>
        Road Map</a>
            </li>
                
      <li>
  
                          <a href="newsletter.html" title="Newsletter">
          <span class="none"></span>
        Newsletter</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <span class="icon-chevron-right"></span>
        Project Information</a>
                  </li>
                                                                                                                                                                                                                                                      
      <li>
  
                          <a href="project-reports.html" title="Project Reports">
          <span class="icon-chevron-right"></span>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <h1>Change Log</h1>
<div class="section">
<h2><a name="Improvements_in_HEAD"></a>Improvements in HEAD</h2></div>
<div class="section">
<h2><a name="Improvements_up_to_v1.5.0"></a>Improvements up to v1.5.0</h2>
<div class="section">
<h3><a name="Fixed"></a>Fixed</h3>

<ul>
  
<li>Two rare, subtle matching bugs in SpansExpansion and SpansPositionFilter.</li>
  
<li>Fixed indexing bug where the compression code would occasionally get stuck in a loop.</li>
</ul></div>
<div class="section">
<h3><a name="Changed"></a>Changed</h3>

<ul>
  
<li>Deprecated TextPattern.toString() methods that take arguments.</li>
  
<li>Gave HitProperty and DocProperty default toString() implementation.</li>
  
<li>Added methods for iterating over all Lucene documents, forward index documents,  content store documents.</li>
  
<li>Added a test utility that can export your original corpus from the Lucene  index and content store (nl.inl.blacklab.testutil.ExportCorpus).</li>
  
<li>Many RuntimeExceptions were changed to more specific subclasses like  IllegalArgumentException or UnsupportedOperationException.</li>
  
<li>Made it possible to add a metadata field with a fixed value to every  document in a single IndexTool run. Useful if you want to combine multiple  corpora into a single index: add each corpus in a separate IndexTool run,  with a field Corpus with the appropriate name.</li>
</ul></div>
<div class="section">
<h3><a name="BlackLab_Server"></a>BlackLab Server</h3>

<ul>
  
<li>Made it possible to use POST for queries, so you can execute very large  queries (many kilobytes). Note that very long (&gt;30KB) regular expressions  can trigger problems in Lucene though.</li>
  
<li>Allowed previously forbidden all-docs query (now that large document  queries are faster and less memory hungry).</li>
  
<li>Grouped results are sorted by identity by default now.</li>
  
<li>Made docpid a general way to easily filter on a single document PID.</li>
  
<li>Replaced building a DataObject tree and serializing it with directly  streaming the response data using DataStream, saving memory and time.</li>
  
<li>Heavily refactored to be more modular.</li>
  
<li>Removed some settings related to nonblocking mode, as they didn&#x2019;t seem  very useful.</li>
  
<li>Used JSON.org library instead of copy of the code.</li>
  
<li>FIXED: if counting hits takes too long, don&#x2019;t error out but show the  results we have.</li>
  
<li>FIXED: Do returns results even if counting all the results was interrupted  because it took too long.</li>
</ul></div></div>
<div class="section">
<h2><a name="Improvements_up_to_v1.4.1"></a>Improvements up to v1.4.1</h2>
<div class="section">
<h3><a name="Fixed"></a>Fixed</h3>

<ul>
  
<li>Potential overflow bug in ContentStoreFixedBlock when retrieving content.</li>
  
<li>ContentStoreFixedBlock decompression bug that occurred with highly compressable content.  (N.B. there is no need to re-index if you experienced either of the above bugs)</li>
</ul></div>
<div class="section">
<h3><a name="Changed"></a>Changed</h3>

<ul>
  
<li>Don&#x2019;t store Document objects in DocResults, saving memory and time.</li>
  
<li>Changed BL-CQL subproperty separator (e.g. for querying part of speech features separately)  from &#x2018;:&#x2019; to &#x2018;/&#x2019;.</li>
</ul></div>
<div class="section">
<h3><a name="BlackLab_Server"></a>BlackLab Server</h3>

<ul>
  
<li>Made sure missing options in blacklab-server.json don&#x2019;t cause problems.</li>
</ul></div></div>
<div class="section">
<h2><a name="Improvements_up_to_v1.4.0"></a>Improvements up to v1.4.0</h2>
<div class="section">
<h3><a name="New"></a>New</h3>

<ul>
  
<li>Added experimental support for &#x201c;subproperties&#x201d;: properties that are indexed in the same Lucene  field, using prefixes, but don&#x2019;t each have a forward index. For now, mainly useful for  indexing each part of speech feature separately, but in the future, BlackLab could possibly move  to indexing all properties in a single Lucene field. See DocIndexerOpenSonar,  QueryExecutionContext.subpropPrefix().</li>
  
<li>Added HitsSample and its implementation class, which can take a random sample of a larger  set of hits.</li>
  
<li>Added HitPropertyContextWords, which gives the user more options for sorting/grouping on  context words, such as &#x201c;group on the first and last words of the matched text&#x201d; or &#x201c;group on the  second and third words to the left of the matched text&#x201d;.</li>
</ul></div>
<div class="section">
<h3><a name="Changed"></a>Changed</h3>

<ul>
  
<li>Performed some code cleanups, moved some internal classes to different packages.</li>
  
<li>Made Searcher an abstract base class to SearcherImpl; Hits an abstract base class to HitsImpl.  Added mock classes for Searcher, Hits, ForwardIndex, Terms; used them to add tests.</li>
  
<li>Moved hits-related settings from Searcher and Hits into a shared HitsSetting class;  Searcher has a default set of HitsSettings that Hits objects &#x201c;inherit&#x201d;.</li>
  
<li>Updated gs-collections 6.1 to eclipse-collections 7.1. Replaced Map&lt;Integer, T&gt; with  IntObjectMap, Map&lt;Integer, Integer&gt; with IntIntMap, ArrayList&lt;Integer&gt; with IntArrayList  a number of times (mainly) for more memory-efficiency.</li>
  
<li>Started using commons-lang to replace certain utility functions.</li>
  
<li>Moved some basic Lucene functionality unrelated to the rest of BlackLab from Searcher to  LuceneUtil.</li>
</ul></div></div>
<div class="section">
<h2><a name="Improvements_up_to_v1.3.7"></a>Improvements up to v1.3.7</h2>
<div class="section">
<h3><a name="Fixed"></a>Fixed</h3>

<ul>
  
<li>Opening a large &#x201c;fixed-block&#x201d; content store took a really long time.</li>
</ul></div></div>
<div class="section">
<h2><a name="Improvements_up_to_v1.3.6"></a>Improvements up to v1.3.6</h2>
<div class="section">
<h3><a name="Fixed"></a>Fixed</h3>

<ul>
  
<li>Content store growing larger than 2 GB caused an integer overflow.</li>
  
<li>DocIndexersXmlHandlers element matching didn&#x2019;t work correctly for some XML structures.</li>
  
<li>Storing document in ContentStoreDirFixedBlock would very rarely crash due to a  block resizing bug.</li>
</ul></div></div>
<div class="section">
<h2><a name="Improvements_up_to_v1.3.5"></a>Improvements up to v1.3.5</h2>
<div class="section">
<h3><a name="Fixed"></a>Fixed</h3>

<ul>
  
<li>BLSpanOrQuery would occasionally miss valid hits due to a  bug in the advanceStartPoint() method.</li>
</ul></div>
<div class="section">
<h3><a name="New"></a>New</h3>

<ul>
  
<li>Added default unknown condition and value to indextemplate.json, so you can specify what to do if a metadata field value is missing without specifying it for each field separately.</li>
</ul></div>
<div class="section">
<h3><a name="Changed"></a>Changed</h3>

<ul>
  
<li>Switched to JavaCC 6.x.</li>
</ul></div></div>
<div class="section">
<h2><a name="Improvements_up_to_v1.3.4"></a>Improvements up to v1.3.4</h2>
<div class="section">
<h3><a name="Fixed"></a>Fixed</h3>

<ul>
  
<li>Lone carriage return characters in JSON output were not escaped;  Windows line endings were escaped as a single \n.</li>
</ul></div></div>
<div class="section">
<h2><a name="Improvements_up_to_v1.3.3"></a>Improvements up to v1.3.3</h2>
<div class="section">
<h3><a name="Fixed"></a>Fixed</h3>

<ul>
  
<li>Indices with old terms file format (pre-1.3) produced empty concordances.</li>
</ul></div></div>
<div class="section">
<h2><a name="Improvements_up_to_v1.3.2"></a>Improvements up to v1.3.2</h2>
<div class="section">
<h3><a name="Fixed"></a>Fixed</h3>

<ul>
  
<li>Query rewrite bug when combining identical clauses with different repetitions,  i.e. [pos=&#x201c;AA.<i>&#x201c;][pos=&#x201d;AA.</i>&#x201d;]* &#x2013;&gt; [pos=&#x201c;AA.*&#x201d;]+</li>
  
<li>Throw a descriptive error if an index contains no fields.</li>
</ul></div>
<div class="section">
<h3><a name="Changed"></a>Changed</h3>

<ul>
  
<li>Some small code quality improvements, like using .isEmpty() instead of .size() == 0.</li>
  
<li>Added -javadoc and -sources JARs to Maven build, in preparation for publishing to Maven Central.</li>
  
<li>Added distributionManagement section for deploying to OSSRH staging area.</li>
</ul></div></div>
<div class="section">
<h2><a name="Improvements_up_to_v1.3.1"></a>Improvements up to v1.3.1</h2>
<div class="section">
<h3><a name="Fixed"></a>Fixed</h3>

<ul>
  
<li>Bug in SpanQueryAnd which caused incorrect hits to be reported.</li>
</ul></div>
<div class="section">
<h3><a name="New"></a>New</h3>

<ul>
  
<li>Added new default content store format &#x201c;fixedblock&#x201d;, that improves space re-use when updating documents.</li>
</ul></div></div>
<div class="section">
<h2><a name="Changed"></a>Changed</h2>

<ul>
  
<li>Special OSX and Windows files are skipped, even if they occur inside archives.</li>
</ul></div>
<div class="section">
<h2><a name="Improvements_up_to_v1.3"></a>Improvements up to v1.3</h2>
<div class="section">
<h3><a name="Added"></a>Added</h3>

<ul>
  
<li>Searcher now implements Closeable, so it can be used with the try-with-resources statement.</li>
  
<li>You can specify that properties should not get a forward index using the complexField property &#x201c;noForwardIndexProps&#x201d; (space-separated list of property names) in indextemplate.json.</li>
</ul></div>
<div class="section">
<h3><a name="Fixed"></a>Fixed</h3>

<ul>
  
<li>Forward index terms is no longer limited to around 2 GB.</li>
</ul></div>
<div class="section">
<h3><a name="Changed"></a>Changed</h3></div></div>
<div class="section">
<h2><a name="Improvements_up_to_v1.2.1"></a>Improvements up to v1.2.1</h2>
<div class="section">
<h3><a name="Fixed"></a>Fixed</h3>

<ul>
  
<li>Queries containing only a document filter (metadata filter) would return incorrect results.</li>
</ul></div></div>
<div class="section">
<h2><a name="Improvements_up_to_v1.2.0"></a>Improvements up to v1.2.0</h2>
<div class="section">
<h3><a name="Changed"></a>Changed</h3>

<ul>
  
<li>Switched build from Ant to Maven, and added generating a project site with javadocs, reports, etc.</li>
  
<li>Using less memory by switching some Maps in the forward index to the gs-collections one.</li>
  
<li>Updated to Lucene 5.2.1.</li>
  
<li>Added Maven project site, available at <a class="externalLink" href="http://inl.github.io/BlackLab/">http://inl.github.io/BlackLab/</a></li>
  
<li>Removed Lucene query parser for corpus queries.</li>
  
<li>Keep tag end position in payload of start tag, which results in much faster tag searches.</li>
  
<li>Rewrote many slower queries to make them (much) faster. Particularly searches with &#x201c;not&#x201d; parts and &#x201c;containing&#x201d;/&#x201c;within&#x201d; should be faster.</li>
  
<li>Sped up &#x201c;containing&#x201d;, &#x201c;within&#x201d;, and other such filter queries.</li>
  
<li>TextPatternAnd was renamed and expanded to TextPatternAndNot. TextPatternAnd is still available as a synonym, but has been deprecated.</li>
  
<li>Added TextPatternFilterNGrams to speed up queries of the form: []{2,3} containing &#x201c;water&#x201d; (or the &#x201c;within&#x201d; equivalent).</li>
  
<li>Added BLSpans.advanceStartPosition(target) to &#x201c;skip&#x201d; within a document.</li>
  
<li>Commons-compress (used for reading .gz files) is statically linked now.</li>
  
<li>Limited token length to 1000 (really long tokens would cause problems otherwise).</li>
</ul></div>
<div class="section">
<h3><a name="Fixed"></a>Fixed</h3>

<ul>
  
<li>Empty version file causes NullPointerException.</li>
  
<li>Missing manifest file causes NullPointerException.</li>
  
<li>ContentStoreDir contained dependencies on the default encoding.</li>
  
<li>A number of subtle search bugs.</li>
  
<li>Opening an index by passing a symbolic link throws an exception.</li>
  
<li>Miscellaneous small fixes.</li>
</ul></div></div>
<div class="section">
<h2><a name="Improvements_up_to_v1.1.0"></a>Improvements up to v1.1.0</h2>

<ul>
  
<li>Upgraded from Lucene 3.6 to Lucene 4.2. This should speed up regular expression searching, among other things. The required Lucene 4 modules are: core, highlighter, queries, queryparser, analyzers-common. Thanks to Marc Kemps-Sneijders from the Meertens Institute for the code submission!</li>
  
<li>The awkwardly-named classes RandomAccessGroup(s) were renamed to HitGroup(s). Also, DocGrouper was renamed to DocGroups to match this naming scheme. The old versions are still around but have been deprecated.</li>
  
<li>HitPropValue classes now need a Hits object to properly serialize/deserialize their values in a way that doesn&#x2019;t break after re-indexing.</li>
  
<li>Manual object construction was replaced with method calls where possible, for convenience, speed and ease of refactoring. Examples: use Hits.window() instead of new HitsWindow(); use Hits.groupedBy() instead of new ResultsGrouper(); use DocResults.groupedBy() instead of new DocGroups(). (code to the HitGroups/DocGroups APIs instead of to the concrete type ResultsGrouper/DocGrouper). Same for DocResults.</li>
  
<li>HitGroups now iterates over HitGroup (used to iterate over Group)</li>
  
<li>If you just want to query documents (not find hits for a pattern), use Searcher.queryDocuments(Query) (returns DocResults without hits).</li>
  
<li>Preferably use Hits.sortedBy() (returns a new Hits instance) instead of Hits.sort() (modifies Hits instance). In a future version, we want Hits to become immutable to facilitate caching in a multithreaded application. Note that although you get a new Hits instance, the hits themselves are not all copied (no need, because the Hit class is now immutable).</li>
  
<li>LuceneQueryParser.allowLeadingWildcard now defaults to false like in Lucene itself. Call LuceneQueryParser.setAllowLeadingWildcard() to change the setting.</li>
  
<li>If you want to control how indexing errors are handled, subclass IndexListener and override the errorOccurred() method. This method receives information on what file couldn&#x2019;t be indexed and why.</li>
  
<li>Visibility for some internal classes and methods has been reduced from public to package-private to trim the public API footprint, promoting ease-of-use and facilitating future refactoring. This should not affect applications. If it does affect you, please let me know.</li>
  
<li>Some other methods have been renamed, are no longer needed, etc. and have been deprecated. Deprecated methods state the preferred alternative in the @deprecated Javadoc directive.</li>
</ul></div>
<div class="section">
<h2><a name="Improvements_up_to_v1.0"></a>Improvements up to v1.0</h2>
<div class="section">
<h3><a name="Features"></a>Features</h3>

<ul>
  
<li>Sorting/grouping on multiple properties now works correctly. Use HitPropertyMultiple.</li>
  
<li>You can now sort/group (case-/accent-) sensitively or insensitively.</li>
  
<li>You can now easily get a larger snippet of context around a single hit (say, 100 words before and after the hit). Call Hits.getConcordance(String, Hit, int) for this purpose.</li>
  
<li>Indexing classes now work using element handlers, making them much more readable. Supporting a new file format has become simpler as a result of this. TEI P4/P5 and FoLiA indexing classes are included with BlackLab now. See nl.inl.blacklab.indexers package.</li>
  
<li>It is now possible to delete documents from your index. The forward indices will reuse the free space for new documents.</li>
  
<li>The Hits class should be thread-safe now. This makes several things possible: paging through hits without re-executing the query and quickly displaying the first few hits while a background thread fetches the rest. You can even display a running counter while hits are being fetched.</li>
  
<li>nl.inl.blacklab.tools.IndexTool is a new generic indexing tool. It is command-line utility that lets you create new indices, add documents to them and delete them again. Indexing can be customized via commandline parameters and/or a properties file. Pass &#x2013;help for more info.</li>
  
<li>QueryTool, the command-line search tool and demonstration program, has been improved with many little features, including a performance test mode.</li>
  
<li>Long-running queries may be interrupted using Thread.interrupt(); this will stop the gathering of hits and return control to the caller.</li>
  
<li>Hacked in (very) experimental SRU CQL (Contextual Query Language) support. Still needs a bit more love though. :-)</li>
</ul></div>
<div class="section">
<h3><a name="Performance-memory-related"></a>Performance-/memory-related</h3>

<ul>
  
<li>Concordances (for KWIC views) are constructed using the forward indices now (including the one for the new &#x2018;punct&#x2019; property, containing punctuation and whitespace between words &#x2013; if you created your own indexer, it pays to update it to include this property). Before they were constructed using the content store, but this method is much faster and more disk cache friendly.</li>
  
<li>Startup speed has been improved, and there is an option to automatically &#x201c;warm up&#x201d; forward indices (i.e. prime the disk cache) in a background thread on startup. Enable this by calling Searcher.setAutoWarmForwardIndices(true); before constructing a Searcher object. This may become the default behaviour in future versions.</li>
  
<li>Applications have more control over the maximum number of hits to retrieve, and the maximum hits to count. &#x201c;Unlimited&#x201d; is also an option. By default, no more than 1M hits are retrieved, but all hits are counted.</li>
  
<li>Several types of queries (notably, phrase searches) have been sped up using the &#x2018;guarantee&#x2019; methods in BLSpans to determine when certain operations can be skipped.</li>
  
<li>Several other small improvements in performance and memory use.</li>
</ul></div>
<div class="section">
<h3><a name="Other"></a>Other</h3>

<ul>
  
<li>Opening the BlackLab index should now be done using Searcher.open() instead of directly through constructor. See the [https://github.com/INL/BlackLab/commit/d1d1b71ca8d5ef2aea25eab5a6e12b7e51cf5f65 commit message] for the rationale.</li>
  
<li>Several superfluous methods were deprecated to simplify the API. The Javadoc will indicate why a method was deprecated and what alternative you should use. Deprecated methods will be removed in the next major version.</li>
  
<li>Many small bugs fixed, comments added and code structure improved.</li>
</ul></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                    2016
                        <a href="http://www.inl.nl">Instituut voor Nederlandse Taal (INT)</a>.
            All rights reserved.      
                    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
