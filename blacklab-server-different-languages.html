<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2016-08-23 
 | Rendered using Apache Maven Fluido Skin 1.4
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20160823" />
    <meta http-equiv="Content-Language" content="en" />
    <title>BlackLab &#x2013; Using from different languages</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.4.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.4.min.js"></script>

                          
        
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Nunito:300"/>
          
                  </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                                                                                                <img src="images/logo-blacklab.png"  alt="BlackLab"/>
                </div>
                      </div>
        <div class="pull-right">                  <a href="http://www.inl.nl/" id="bannerRight">
                                                                                                <img src="images/logo-inl.png"  alt="INL"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="http://www.inl.nl/" class="externalLink" title="INL">
        INL</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="index.html" title="BlackLab">
        BlackLab</a>
                    <span class="divider">/</span>
      </li>
        <li class="active ">Using from different languages</li>
        
                
                    
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2016-08-23</li>
              <li id="projectVersion" class="pull-right">
                    Version: 1.6.0-SNAPSHOT
        </li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">BlackLab</li>
                              
      <li>
  
                          <a href="index.html" title="Introduction">
          <span class="none"></span>
        Introduction</a>
            </li>
                                                                                                                                                                                                                      
      <li>
  
                          <a href="learn.html" title="Learn">
          <span class="icon-chevron-down"></span>
        Learn</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="getting-started.html" title="Getting Started">
          <span class="none"></span>
        Getting Started</a>
            </li>
                    
      <li>
  
                          <a href="corpus-query-language.html" title="Corpus Query Language">
          <span class="none"></span>
        Corpus Query Language</a>
            </li>
                    
      <li>
  
                          <a href="blacklab-server-overview.html" title="BlackLab Server overview">
          <span class="none"></span>
        BlackLab Server overview</a>
            </li>
                    
      <li class="active">
  
            <a href="#"><span class="none"></span>Using BlackLab Server from different languages</a>
          </li>
                    
      <li>
  
                          <a href="indexing-with-blacklab.html" title="Indexing with BlackLab">
          <span class="none"></span>
        Indexing with BlackLab</a>
            </li>
                    
      <li>
  
                          <a href="add-input-format.html" title="Add An Input Format">
          <span class="none"></span>
        Add An Input Format</a>
            </li>
                    
      <li>
  
                          <a href="improve-search-speed.html" title="Improve Search Speed">
          <span class="none"></span>
        Improve Search Speed</a>
            </li>
                    
      <li>
  
                          <a href="apidocs/index.html" title="API reference">
          <span class="none"></span>
        API reference</a>
            </li>
                    
      <li>
  
                          <a href="file-formats.html" title="File formats">
          <span class="none"></span>
        File formats</a>
            </li>
              </ul>
        </li>
                
      <li>
  
                          <a href="downloads.html" title="Downloads">
          <span class="none"></span>
        Downloads</a>
            </li>
                
      <li>
  
                          <a href="faq.html" title="FAQ">
          <span class="none"></span>
        FAQ</a>
            </li>
                
      <li>
  
                          <a href="changelog.html" title="Change Log">
          <span class="none"></span>
        Change Log</a>
            </li>
                
      <li>
  
                          <a href="roadmap.html" title="Road Map">
          <span class="none"></span>
        Road Map</a>
            </li>
                
      <li>
  
                          <a href="newsletter.html" title="Newsletter">
          <span class="none"></span>
        Newsletter</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <span class="icon-chevron-right"></span>
        Project Information</a>
                  </li>
                                                                                                                                                                                                                                                      
      <li>
  
                          <a href="project-reports.html" title="Project Reports">
          <span class="icon-chevron-right"></span>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <h1>Using from different languages</h1>
<p>Below are examples of using BlackLab Server to fetch hits for a simple Corpus Query Language query from different programming languages.</p>

<ul>
  
<li><a href="#java">Java</a></li>
  
<li><a href="#javascript-jquery">Javascript + jQuery</a></li>
  
<li><a href="#perl">Perl</a></li>
  
<li><a href="#php">PHP</a></li>
  
<li><a href="#python">Python</a></li>
  
<li><a href="#r">R</a></li>
  
<li><a href="#ruby">Ruby</a></li>
</ul>
<p><a name="java" id="java"></a></p>
<h1>Java</h1>

<div class="source">
<div class="source"><pre class="prettyprint">import org.json.simple.*;
import java.io.*;
import java.net.*;

class BlackLabServerTest {

    /** The BlackLab Server url for searching &quot;mycorpus&quot; (not a real URL) */
    final static String BASE_URL = &quot;http://example.com/blacklab/mycorpus/&quot;;

    /** Fetch the specified URL and decode the returned JSON.
     * @param url the url to fetch
     * @return the page fetched
     */
    public static JSONObject fetch(String url) throws Exception {
       // Read from the specified URL.
        InputStream is = new URL(url).openStream();
        try {
           String line;
           BufferedReader br = new BufferedReader(new InputStreamReader(is));
            StringBuilder b = new StringBuilder();
            while ((line = br.readLine()) != null) {
                b.append(line);
            }
           return new JSONObject(b.toString());
        } finally {
            is.close();
        }
    }

    /** Context of the hit is passed in arrays, per property
     * (word/lemma/PoS). Right now we only want to display the 
     * words. This is how we join the word array to a string.
     * @param context context structure containing word, lemma, PoS.
     * @return the words joined together with spaces.
     */
    static String words(JSONObject context) {
       JSONArray words = (JSONArray)context.get(&quot;word&quot;);
       StringBuilder b = new StringBuilder();
       for (int i = 0; i &lt; words.size(); i++) {
         if (b.length() &gt; 0)
          b.append(&quot; &quot;);
         b.append((String)words.get(i));
       }
       return b.toString();
    }


    /** Show an array of hits in an HTML table.
     * @param hits the hits structure from the JSON response
     * @param docs the docInfos structure from the JSON response
     */
    public static void showHits(JSONArray hits, JSONObject docs) {

       // Iterate over the hits.
       // We'll add elements to the html array and join it later to produce our
       // final HTML.
       StringBuilder html = new StringBuilder();
       html.append(&quot;&lt;table&gt;&lt;tr&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;Keyword in context&lt;/th&gt;&lt;/tr&gt;\n&quot;);
       for (int i = 0; i &lt; hits.length(); i++) {
         JSONObject hit = (JSONObject)hits.get(i);

         // Add the document title and the hit information
         JSONObject doc = (JSONObject)docs.get((String)hit.get(&quot;docPid&quot;));

         // Context of the hit is passed in arrays, per property
         // (word/lemma/PoS). Right now we only want to display the 
         // words. This is how we join the word array to a string.
         String left = words((JSONObject)hit.get(&quot;left&quot;));
         String match = words((JSONObject)hit.get(&quot;match&quot;));
         String right = words((JSONObject)hit.get(&quot;right&quot;));

         html.append(&quot;&lt;tr&gt;&lt;td&gt;&quot; + (String)doc.get(&quot;title&quot;) + &quot;&lt;/td&gt;&lt;td&gt;&quot; + left +
          &quot; &lt;b&gt;&quot; + match + &quot;&lt;/b&gt; &quot; + right + &quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;);
       }
       html.append(&quot;&lt;/table&gt;\n&quot;);
       System.out.println(html.toString()); // Join lines and output
    }


    /** Performs a search and shows the results.
     * @param patt the pattern to search for
     */
    public static void performSearch(String patt) throws Exception {

       // Carry out the request and call the showHits function
       String url = BASE_URL + &quot;hits?patt=&quot; + URLEncoder.encode(patt, &quot;utf-8&quot;) + &quot;&amp;outputformat=json&quot;;
       JSONObject response = fetch(url);

       // Got results. Show the hits, along with the document titles.
       JSONArray hits = (JSONArray)response.get(&quot;hits&quot;);
       JSONObject docs = (JSONObject)response.get(&quot;docInfos&quot;);
       showHits(hits, docs);
    }

    /** Main method.
     * @param argv command-line arguments
     */
    public static void main(String[] argv) throws Exception {
       performSearch(&quot;\&quot;quick\&quot;&quot;);
    }

}
</pre></div></div>
<p>&#160;<a name="javascript-jquery" id="javascript-jquery"></a></p>
<h1>Javascript / jQuery</h1>
<p>Javascript with jQuery:</p>

<div class="source">
<div class="source"><pre class="prettyprint">// The BlackLab Server url for searching &quot;mycorpus&quot; (not a real URL)
var BASE_URL = &quot;http://example.com/blacklab/mycorpus/&quot;;

// Show an array of hits in a table
function showHits(hits, docs) {

    // Context of the hit is passed in arrays, per property
    // (word/lemma/PoS). Right now we only want to display the 
    // words. This is how we join the word array to a string.
    function words(context) {
       return context['word'].join(&quot; &quot;);
    }

    // Iterate over the hits.
    // We'll add elements to the html array and join it later to produce our
    // final HTML.
    var html = [&quot;&lt;table&gt;&lt;tr&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;Keyword in context&lt;/th&gt;&lt;/tr&gt;&quot;];
    $.each(hits, function (index, hit) {

       // Add the document title and the hit information
       var doc = docs[hit['docPid']];
       html.push(&quot;&lt;tr&gt;&lt;td&gt;&quot; + doc['title'] + &quot;&lt;/td&gt;&lt;td&gt;&quot; + words(hit['left']) +
         &quot; &lt;b&gt;&quot; + words(hit['match']) + &quot;&lt;/b&gt; &quot; + words(hit['right']) + 
         &quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
    });
    html.push(&quot;&lt;/table&gt;&quot;);
    output(html.join(&quot;\n&quot;)); // Join lines and append to output area
}

// Main program: performs a search and shows the results
function performSearch(patt) {

    // Clear the output area
    clear();

    // Carry out the request and call the showHits function
    $.ajax({
       url: BASE_URL + &quot;hits&quot;,
       jsonp: &quot;jsonp&quot;,
       dataType: &quot;jsonp&quot;,
       data: {
         patt: patt
       },
       success: function (response) {
         // Got results. Show the hits, along with the document titles.
         showHits(response['hits'], response['docInfos']);
       }
    });
}

// Clear output area
function clear() {
    $('#output').html('');
}

// Add HTML to the output area
function output(addHtml) {
    $('#output').append(addHtml).append(&quot;\n&quot;);
}
</pre></div></div>
<p>&#160;<a name="perl" id="perl"></a></p>
<h1>Perl</h1>

<div class="source">
<div class="source"><pre class="prettyprint">use strict;
use warnings;
use WebService::Simple;
use JSON::Parse ':all';

# The BlackLab Server url for searching &quot;mycorpus&quot; (not a real URL)
my $BASE_URL = &quot;http://example.com/blacklab/mycorpus/&quot;;

# Perform the search and decode the returned JSON.
sub fetchSearchResults {
    my ($patt) = @_;

    my $response;
    # Initialize WebService::Simple for JSON webservice
    my $blacklab = WebService::Simple-&gt;new(
        base_url        =&gt; $BASE_URL,
        response_parser =&gt; 'JSON'
    );

    # Send query
    my $responseObj = $blacklab-&gt;get(&quot;hits&quot;, { patt =&gt; $patt, outputformat =&gt; &quot;json&quot; } );
    $response = $responseObj-&gt;parse_response;
}

# Show an array of hits in a table
sub showHits {
    my ($hits, $docs) = @_; # Unpack parameters

    print &quot;&lt;table&gt;&lt;tr&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;Keyword in context&lt;/th&gt;&lt;/tr&gt;\n&quot;;
    foreach my $hit (@$hits) {
       # Get the document metadata so we can print the title.
       my $doc = $docs-&gt;{$hit-&gt;{'docPid'}};

       # Context of the hit is passed in arrays, per property
       # (word/lemma/PoS). Right now we only want to display the 
       # words. Join the arrays into strings.
       my $left  = join(&quot; &quot;, @{$hit-&gt;{'left'}{'word'}});
       my $match = join(&quot; &quot;, @{$hit-&gt;{'match'}{'word'}});
       my $right = join(&quot; &quot;, @{$hit-&gt;{'right'}{'word'}});

       # Show the hit information
       print &quot;&lt;tr&gt;&lt;td&gt;&quot;.$doc-&gt;{'title'}.&quot;&lt;/td&gt;&quot;.
         &quot;&lt;td&gt;$left&lt;b&gt;$match&lt;/b&gt;$right&lt;/td&gt;&lt;/tr&gt;\n&quot;;
    }
    print &quot;&lt;/table&gt;\n&quot;;
}

# Main program: performs a search and shows the results
sub performSearch {
    my ($patt) = @_; # Unpack parameters
    my $response = &amp;fetchSearchResults($patt);
    &amp;showHits($response-&gt;{'hits'}, $response-&gt;{'docInfos'});
}

# Run the main program
&amp;performSearch('&quot;quick&quot;');
</pre></div></div>
<p>&#160;<a name="php" id="php"></a></p>
<h1>PHP</h1>

<div class="source">
<div class="source"><pre class="prettyprint">&lt;?php

// The BlackLab Server url for searching &quot;mycorpus&quot; (not a real URL)
define(&quot;BASE_URL&quot;, &quot;http://example.com/blacklab/mycorpus/&quot;);

// Fetch the specified URL and decode the returned JSON.
function fetch($url) {
    // Read from the specified URL.
    $responseTxt = file_get_contents($url);
    return json_decode($responseTxt, true);
}

// Show an array of hits in a table
function showHits($hits, $docs) {
    print &quot;&lt;table&gt;&lt;tr&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;Keyword in context&lt;/th&gt;&lt;/tr&gt;\n&quot;;

    // Context of the hit is passed in arrays, per property
    // (word/lemma/PoS). Right now we only want to display the 
    // words. This is how we join the word array to a string.
    function words($context) {
       return join(&quot; &quot;, $context['word']);
    }

    foreach($hits as $hit) {

       // Get the document metadata so we can print the title.
       $doc = $docs[$hit['docPid']];

       // Show the hit information
       $tableRow = &quot;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s &lt;b&gt;%s&lt;/b&gt; %s&lt;/td&gt;&lt;/tr&gt;\n&quot;;
       print sprintf($tableRow, $doc['title'], words($hit['left']), 
         words($hit['match']), words($hit['right']));
    }
    print &quot;&lt;/table&gt;&quot;;
}

// Main program: performs a search and shows the results
function performSearch($patt) {

    // Carry out the request and parse the response JSON
    $response = fetch(BASE_URL.&quot;hits?patt=&quot;.urlencode($patt)).&quot;&amp;outputformat=json&quot;;

    // Show the hits, along with the document titles
    showHits($response['hits'], $response['docInfos']);
}

// Run the main program
performSearch('&quot;quick&quot;');

?&gt;
</pre></div></div>
<p>&#160;<a name="python" id="python"></a></p>
<h1>Python</h1>

<div class="source">
<div class="source"><pre class="prettyprint">import urllib
import json

def words(context):
    &quot;&quot;&quot; Convert word array to string. &quot;&quot;&quot;
    return &quot; &quot;.join(context['word'])

def search(cqlQuery):
    &quot;&quot;&quot; Search and show hits. &quot;&quot;&quot;
    url = &quot;http://example.com/blacklab/mycorpus/hits?patt=&quot;
         + urllib.quote_plus(cqlQuery) + &quot;&amp;outputformat=json&quot;
    with (urllib.open(url)) as f:
       response = json.loads(f.read())
    hits = response['hits']
    docs = response['docInfos']
    for hit in hits:
       # Show the document title and hit information
       doc = docs[hit['docPid']]
       print words(hit['left']) + &quot; [&quot; + words(hit['match']) + &quot;] &quot; + 
          words(hit['right']) + &quot; (&quot; + doc['title'] + &quot;)&quot;

# &quot;Main program&quot;
search('[pos=&quot;a.*&quot;] &quot;fox&quot;')
</pre></div></div>
<p>&#160;<a name="r" id="r"></a></p>
<h1>R</h1>

<div class="source">
<div class="source"><pre class="prettyprint">suppressMessages(library(&quot;RCurl&quot;))
suppressMessages(library(&quot;rjson&quot;))

# Convert word array to string.
words &lt;- function(context) {
    return(paste(context[['word']], collapse=&quot; &quot;))
}

# Search and show hits.
search &lt;- function(cqlQuery) {
    url &lt;- paste(&quot;http://example.com/blacklab/mycorpus/hits?patt=&quot;, 
         curlEscape(cqlQuery), &quot;&amp;outputformat=json&quot;, sep=&quot;&quot;)
    response &lt;- fromJSON(paste(readLines(url), collapse=&quot;&quot;))
    docs &lt;- response[['docInfos']]
    hits &lt;- response[['hits']]
    for(hit in hits) {
       # Add the document title and the hit information
       doc &lt;- docs[[ hit[['docPid']] ]];
       cat(paste(words(hit[['left']]),
          &quot; [&quot;, words(hit[['match']]), &quot;] &quot;, words(hit[['right']]),
          &quot; (&quot;, doc[['title']], &quot;)\n&quot;, sep=&quot;&quot;, collapse=&quot;\n&quot;))
    }
    return()
}

invisible(search('[pos=&quot;a.*&quot;] &quot;fox&quot;'))
</pre></div></div>
<p>&#160;<a name="ruby" id="ruby"></a></p>
<h1>Ruby</h1>

<div class="source">
<div class="source"><pre class="prettyprint">require 'json'
require 'open-uri'

# The BlackLab Server url for searching &quot;mycorpus&quot; (not a real URL)
BASE_URL = &quot;http://corpus.inl.nl/blacklab/mycorpus/&quot;

# Simulate fetching URL?
DEBUG = true

def fetch(url)
    &quot;&quot;&quot; Fetch the specified URL and decode the returned JSON. &quot;&quot;&quot;
    if DEBUG
       print &quot;Simulate fetch from #{url}&quot;
       url = 'testdata/test.json'
    end
    return JSON.parse(open(url).read)
end

def showHits(hits, docs)
    &quot;&quot;&quot; Show an array of hits in a table &quot;&quot;&quot;

    # Context of the hit is passed in arrays, per property
    # (word/lemma/PoS). Right now we only want to display the 
    # words. This is how we join the word array to a string.
    def words(context)
       return context['word'].join(&quot; &quot;)
    end

    print &quot;&lt;table&gt;&lt;tr&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;Keyword in context&lt;/th&gt;&lt;/tr&gt;\n&quot;
    hits.each do |hit|
       # Show the document title and hit information
       doc = docs[hit['docPid']]
       print &quot;&lt;tr&gt;&lt;td&gt;#{doc['title']}&lt;/td&gt;&quot; +
         &quot;&lt;td&gt;#{words(hit['left'])} &lt;b&gt;#{words(hit['match'])}&lt;/b&gt; &quot; +
         &quot;#{words(hit['right'])}&lt;/td&gt;&lt;/tr&gt;\n&quot;
    end
    print &quot;&lt;/table&gt;\n&quot;
end

def performSearch(patt)
    &quot;&quot;&quot; Main program: performs a search and shows the results &quot;&quot;&quot;

    # Carry out the request and parse the response JSON
    response = fetch(&quot;#{BASE_URL}hits?patt=#{URI::encode(patt)}&amp;outputformat=json&quot;)

    # Show the hits, along with the document titles
    showHits(response['hits'], response['docInfos'])
end

performSearch('&quot;quick&quot;')
</pre></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                    2016
                        <a href="http://www.inl.nl">Instituut voor Nederlandse Taal (INT)</a>.
            All rights reserved.      
                    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
